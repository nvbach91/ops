function binaryIndexOf(e){"use strict";for(var t,a,i=0,d=this.length-1;d>=i;)if(t=(i+d)/2|0,a=this[t],e>a)i=t+1;else{if(!(a>e))return t;d=t-1}return-1}var windowWidth=window.innerWidth,animationTime=windowWidth>=768?100:0;Array.prototype.binaryIndexOf=binaryIndexOf;var Item=function(e,t,a,i,d){this.id=e,this.ean=t,this.name=a,this.price=i,this.desc=d};Item.prototype.valueOf=function(){return this.ean};var createFoundItem=function(e,t){return'<li class="dd-item"><div class="dd-name">'+e+'</div><div class="dd-price">'+t+"</div></li>"},isFloat=function(e){return e===Number(e)&&e%1!==0},beep=function(){var e=document.getElementById("beep");e.pause(),e.currentTime=0,e.play()};String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},Number.prototype.formatMoney=function(e,t,a){var i=this,e=isNaN(e=Math.abs(e))?2:e,t=void 0===t?".":t,a=void 0===a?",":a,d=0>i?"-":"",n=parseInt(i=Math.abs(+i||0).toFixed(e))+"",s=(s=n.length)>3?s%3:0;return d+(s?n.substr(0,s)+a:"")+n.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+a)+(e?t+Math.abs(i-n).toFixed(e).slice(2):"")};var correctPrice=function(e){for(var t=e.replace(/\./g,""),a="";t.length>2&&"0"===t.charAt(0);)t=t.slice(1);return 0===parseInt(t)?!1:(t.length>2?a=t.slice(0,t.length-2)+"."+t.slice(t.length-2,t.length):t.length>1?a="0."+t:t.length>0&&(a="0.0"+t),a)},recalculateTotalCost=function(){var e=$("#sale-list");1===e.children().size()&&$("#si-placeholder").removeClass("hidden");var t=0,a=0;e.find(".sale-item").each(function(){var e=$(this),t=parseInt(e.find(".si-quantity").val());a+=t;var i=parseFloat(e.find(".si-price").text()),d=i*t,n=e.find(".d-discount").val()/100;d-=d*n,d.toFixed(2),e.find(".si-total").text(d.formatMoney(2,".",""))}),e.find(".sale-item .si-total").each(function(){t+=parseFloat($(this).text())}),t.toFixed(2);var i=t.formatMoney(2,","," ");$("#checkout-total").text("Total: "+i+" Kč"),$("#pay-amount").text(i+" Kč"),$("#checkout-label").text("CHECKOUT ("+a+" item"+(1!==a?"s":"")+")")},checkPriceInput=function(e,t){t.text("keyCode: "+e.keyCode);var a=$("#price-input");return 13===e.keyCode?(a.val().length&&a.blur(),!0):8===e.keyCode?!0:109===e.keyCode||189===e.keyCode||173===e.keyCode?a.val().length?!1:a.val().indexOf("-")<0:void((e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault())},checkNumericInput=function(e,t){return 13===e.keyCode?(t.blur(),!0):8===e.keyCode?!0:void((e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault())},showInCurtain=function(e){var t=$("<div></div>").attr("id","curtain").click(function(){$(this).fadeOut(animationTime,function(){$(this).remove()})});t.append(e).hide(),$("#app").append(t),t.fadeIn(animationTime)},addItemToCheckout=function(e,t,a,i,d,n,s){var l=$("#sale-list"),o=l.find("#si-placeholder");o.size()&&o.addClass("hidden"),l.children().size()>0&&l.children().eq(l.children().size()-1).removeClass("last");var r=$("<li>").addClass("sale-item last"),c=$("<div></div>").addClass("sale-item-main");$("<div></div>").addClass("si-id").text(e).appendTo(c),$("<div></div>").addClass("si-name").text(t).appendTo(c),$("<input />").addClass("si-quantity").attr({maxlength:3}).val(1).keydown(function(e){checkNumericInput(e,this)}).focus(function(){$(this).select()}).blur(function(){$(this).val()||$(this).val(0),recalculateTotalCost()}).appendTo(c),$("<div></div>").addClass("si-price").text(a).appendTo(c),$("<div></div>").addClass("si-total").text(a).appendTo(c),$("<button></button").addClass("si-remove").click(function(){$(this).parent().parent().slideUp(animationTime,function(){$(this).remove(),recalculateTotalCost()})}).appendTo(c),c.children(".si-name, .si-price, .si-total").click(function(){$(this).parent().parent().find(".sale-item-extend").slideToggle(animationTime,function(){var e=$(this);e.is(":hidden")?e.parent().removeClass("expanded"):e.parent().addClass("expanded")})}),c.appendTo(r);var p=$("<div></div>").addClass("sale-item-extend"),v=$("<div></div>").addClass("change-price");$("<div></div>").addClass("d-label").text("Individual Price").appendTo(v),$("<input />").addClass("d-price").attr({maxlength:7,placeholder:"e.g. 4200 = 42.00"}).val(a).keydown(function(e){checkNumericInput(e,this)}).blur(function(){var e=$(this),t=e.val(),a=correctPrice(t);a&&/^\-?\d+\.\d{2}$/g.test(a)?(e.removeClass("invalid"),e.val(a),e.parents().eq(2).find(".si-price").text(a),l.find(".d-discount").val()<=100&&recalculateTotalCost()):e.addClass("invalid")}).focus(function(){$(this).select()}).appendTo(v);var u=$("<div></div>").addClass("change-discount");$("<div></div>").addClass("d-label").text("Individual Discount (%)").appendTo(u),$("<input />").addClass("d-discount").attr({maxlength:3,placeholder:"0 - 100"}).val(0).keydown(function(e){checkNumericInput(e,this)}).blur(function(){var e=$(this);/^\d{1,2}$|^100$/g.test(e.val())?(e.removeClass("invalid"),recalculateTotalCost()):e.addClass("invalid")}).focus(function(){$(this).select()}).appendTo(u);var h=$("<div></div>").addClass("open-detail");$("<div></div>").addClass("d-label").text("Details").appendTo(h),$("<button></button>").addClass("d-detail").click(function(){var e=$("<div></div>").attr("id","details-box").click(function(e){e.stopPropagation()});$("<div></div>").addClass("db-header").append($("<div></div>").addClass("db-title").text("Product Details")).append($("<button></button>").addClass("db-close").click(function(){$(this).parents().eq(2).remove()})).appendTo(e);var l=$("<div></div>").addClass("db-body"),o=$("<div></div>").addClass("db-info");$("<div></div>").addClass("db-name").text("Name: "+t).appendTo(o),$("<div></div>").addClass("db-price").text("Price: "+a+" Kč").appendTo(o),$("<div></div>").addClass("db-group").text("Group: "+i).appendTo(o),$("<div></div>").addClass("db-tax").text("Tax: "+d).appendTo(o),$("<div></div>").addClass("db-tags").text("Tags: "+n).appendTo(o),$("<div></div>").addClass("db-desc").text("Description: "+s).appendTo(o),o.appendTo(l),$("<div></div>").addClass("db-img").appendTo(l),l.appendTo(e),showInCurtain(e)}).appendTo(h),v.appendTo(p),u.appendTo(p),h.appendTo(p),p.hide(),p.appendTo(r),r.appendTo(l),l.animate({scrollTop:l[0].scrollHeight},animationTime),recalculateTotalCost(),beep()};$(document).ready(function(){var e=$("#kc"),t=$("#sale-list");$("#discard-sale").click(function(){t.find(".sale-item").slideUp(animationTime,function(){$(this).remove(),recalculateTotalCost()})});var a=$("#price-input"),i=$("#registry-session");a.keydown(function(t){checkPriceInput(t,e)}).blur(function(){var e=$(this).val();if(!/^\-?\d+$/g.test(e)||"-"===e)return $(this).val(""),!1;var t="";"-"===e.charAt(0)&&(e=e.slice(1),t="-");var i=correctPrice(e);return i?void a.val(t+i):(a.val(""),!1)}).click(function(){a.val(""),i.text("0")}).focus(function(){a.val(""),i.text("0")}),$("#sale-groups button").click(function(){var e=$(this),d=t.find(".sale-item.last");if(d.find(".si-name").text().length&&e.text()!==d.find(".si-name").text()&&"1"===i.text())return a.val(""),!1;var n=a.val(),s=parseFloat(n);if(0!==s&&!isNaN(s))if(e.text()===d.find(".si-name").text()&&n===d.find(".si-price").text()&&"1"===i.text()){var l=d.find(".si-quantity");l.val(parseInt(l.val())+1),recalculateTotalCost(),beep()}else{var o=e.text(),r=e.text(),c=e.text(),p=e.text(),v=e.text(),u=e.text();addItemToCheckout(o,r,n,c,p,v,u)}i.text("1")}),$("#quick-sales .qs-item button").click(function(){var e=$(this),i=t.find(".sale-item.last"),d=e.parent().find(".qs-price").text();if(a.val(d),e.parent().find(".qs-id").text()===i.find(".si-id").text()){var n=i.find(".si-quantity");n.val(parseInt(n.val())+1),recalculateTotalCost(),beep()}else{var s=e.text(),l=e.parent().find(".qs-id").text(),o=e.parent().find(".qs-tax").text(),r=e.parent().find(".qs-group").text(),c=e.parent().find(".qs-tags").text(),p=e.parent().find(".qs-desc").text();addItemToCheckout(l,s,d,r,o,c,p)}}),$("#logo > div").click(function(){$("#menu-left").addClass("visible")}),$("#menu-header > div, #main").click(function(){$("#menu-left").removeClass("visible")}),$("#pay").click(function(){var e=$("<div></div>").attr("id","payment-box").click(function(e){e.stopPropagation()});$("<div></div>").addClass("pb-header").append($("<div></div>").addClass("pb-title").text("Payment")).append($("<button></button>").addClass("pb-close").click(function(){$(this).parents().eq(2).remove()})).appendTo(e);var a=$("<div></div>").addClass("pb-body"),i=$("<div></div>").addClass("receipt");$("<div></div>").addClass("receipt-header").text("Receipt Preview").appendTo(i);var d=$("<ul></ul>").addClass("receipt-body");t.find(".sale-item").each(function(){var e=$(this),t=e.find(".si-quantity").val(),a=e.find(".si-name").text(),i=e.find(".si-total").text(),n=$("<li></li>").addClass("receipt-item").append($("<div></div>").addClass("ri-n").text(a)).append($("<div></div>").addClass("ri-x")).append($("<div></div>").addClass("ri-q").text(t)).append($("<div></div>").addClass("ri-tt").text(i));d.append(n)});var n=$("#pay-amount").text().replace(/,/g,".").replace(/[^\d\.]/g,"");d.appendTo(i),$("<div></div>").addClass("receipt-footer").text("EnterpriseApps").appendTo(i);var s=$("<div></div>").addClass("payment");$("<div></div>").addClass("cash-pay-label").text("Amount tendered").appendTo(s);var l=$("<div></div>").attr("id","cash-input-container");$("<input/>").attr("id","cash-input").attr("placeholder","0.00").attr("maxlength","6").val(n).keydown(function(e){checkNumericInput(e,this)}).blur(function(){var e=$(this),t=e.val(),a=correctPrice(t);a&&/^\-?\d+\.\d{2}$/g.test(a)?(e.removeClass("invalid"),e.val(a)):e.addClass("invalid")}).focus(function(){$(this).select()}).appendTo(l),$("<button></button>").addClass("cash-confirm").text("OK").appendTo(l),l.appendTo(s);var o=$("<div></div>").addClass("cash-quick-label").text("Quick cash payment");o.appendTo(s);for(var r=$("<div></div>").addClass("cash-quick"),c=[100,200,500,1e3,2e3,5e3],p=0;p<c.length;p++)$("<button></button>").addClass("cash-button").text(c[p]).click(function(){var e=$(this).text();$("#cash-input").val(e+"00").blur()}).appendTo(r);r.appendTo(s),$("<div></div>").addClass("cash-change").text(0).appendTo(s),s.appendTo(a),$("<div></div>").addClass("receipt-container").append(i).appendTo(a),a.appendTo(e),showInCurtain(e)});for(var d={items:[]},n=0;10>n;n++)d.items.push(new Item(Math.floor(10*Math.random()+1)+n,"4"+n,"Water "+n,15+n+".00","description"));d.items.sort(function(e,t){return e.ean<t.ean?-1:1});var s=$("#dropdown");$("#search").keyup(function(){var e=$(this).val(),t=d.items.binaryIndexOf(e);if(t>=0){var a=d.items[t];s.html(createFoundItem(a.name,a.price)),s.addClass("visible")}else s.html("")}),$("#live-search").blur(function(){s.html(""),s.removeClass("visible")})});